 pipeline{

    agent { label 'E2E_D_AirPlayMacMini' }

    stages{

//        stage("Workspace"){
//            steps{
//               script{
//                    def workspace_link = "<a https://eco2jenkins.bose.com/job/" + JOB_NAME + "/" + BUILD_NUMBER + "/execution/node/3/ws/Screenshot/'>Screenshot</a>";
//                    manager.createSummary("green.gif").appendText("<h1>" + workspace_link + "</h1>", false, false, false, "blue");
//
//                    def workspace_link = "<a https://eco2jenkins.bose.com/job/" + JOB_NAME + "/" + BUILD_NUMBER + "/execution/node/3/ws/'>Workspace</a>";
//                   manager.createSummary("green.gif").appendText("<h1>" + workspace_link + "</h1>", false, false, false, "blue");
//
//               }
//         }
//        }

        stage("Create virtual-env"){
            steps{
                sh """
                python3 -m venv test_environment
                . test_environment/bin/activate
                pip3 install -r requirements.txt
                """
            }
        }


        stage("run change name test file"){
            steps{
                sh"""
                . test_environment/bin/activate

                pytest -vs Tests/test_change_name.py --platformname Android --udid 988a90363239513753 --platformversion 8.0.0

                deactivate
                """
            }
        }


        stage("run check application version test file"){
            steps{
                sh"""
                . test_environment/bin/activate

                pytest -vs Tests/test_check_app_version.py --platformname Android --udid 988a90363239513753 --platformversion 8.0.0

                deactivate
                """
            }
        }


        stage("run inside manage product test file"){
            steps{
                sh"""
                . test_environment/bin/activate

                pytest -vs Tests/test_inner_manage_product.py --platformname Android --udid 988a90363239513753 --platformversion 8.0.0

                deactivate
                """
            }
        }


        stage("run data preference test file"){
            steps{
                sh"""
                . test_environment/bin/activate

                pytest -vs Tests/test_data_pref.py --platformname Android --udid 988a90363239513753 --platformversion 8.0.0

                deactivate
                """
            }
        }


        stage("run manage music test file"){
            steps{
                sh"""
                . test_environment/bin/activate

                pytest -vs Tests/test_manage_music.py --platformname Android --udid 988a90363239513753 --platformversion 8.0.0

                deactivate
                """
            }
        }


        stage("run test notification test file"){
            steps{
                sh"""
                . test_environment/bin/activate

                pytest -vs Tests/test_notification.py --platformname Android --udid 988a90363239513753 --platformversion 8.0.0

                deactivate
                """
            }
        }

   }

   post{
       always{
            script{
                 def exists = fileExists '/Screenshot'

                 if (exists)
                 {
                      archiveArtifacts artifacts: 'Screenshot/*.png', fingerprint: true
                 }
            }
            cleanWs()
       }
   }
}
